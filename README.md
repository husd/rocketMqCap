# view-package
为了研究rocketMQ原理，所以写的一个抓包分析工具，可以解析nameserver和broker等之间的数据交互。

# 使用办法

- 编译 go build husd.com/trace/main
- 运行 main.exe --port=57916

```shell
2021-10-31 14:34:15  ------------------------[ 源IP:端口:192.168.0.110:10911 监听目的端口:57916 ]--------------------
2021-10-31 14:34:15   消息长度 4字节: 126
2021-10-31 14:34:15   序列化类型 1字节: 0
2021-10-31 14:34:15   消息头长度 3字节: 80
2021-10-31 14:34:15   消息头数据 : {"code":0,"extFields":{},"flag":1,"language":"JAVA","opaque":10936,"version":79}
2021-10-31 14:34:15   消息主体数据 : {"consumerIdList":["192.168.0.110@18500"]}
```
阅读rocketMQ的官方文档，可以知道协议是： 消息长度 + 序列化类型&消息头长度 + 消息头数据 + 消息主体数据 这5部分组成。
具体的解释，可以参考RequestCode里的值，比如返回消息的code:0 表示成功，其它表示失败。
请求消息的code表示各种业务关系，例如：Broker 发送消息 的 code = 10

# 其它

- 目前仅支持监听1个端口，如果需要同时监听2个端口，可以开2个终端。
- 默认监听的端口是9876，是nameServer的端口。
